head(rg, 1)
colnames(rg)
bdc <- read.csv("https://raw.githubusercontent.com/bigdatacup/Big-Data-Cup-2021/main/hackathon_nwhl.csv")
head(bdc, 1)
raw <- load_raw_data(game_id = 268078)
raw
rdw <- load_raw_data(game_id = 268116)
rdw
length(raw)
raw[[max(lenght(raw))]]
raw[[max(length(raw))]]
raw[[max(length(raw)) - 1]]
raw[[max(length(raw)) - 1]] %>%
clean_names()
raw[[max(length(raw)) - 1]] %>%
clean_names() %>%
dplyr::select(shots)
raw[[max(length(raw)) - 1]] %>%
clean_names() %>%
dplyr::select(shots) %>%
pivot_wider(values_from = shots)
ah <- data.frame("home", "away")
ah
h <- c("away", "home")
ah <- data.frame(h)
ah
raw[[max(length(raw)) - 1]] %>%
clean_names() %>%
dplyr::select(shots) %>%
right_join(ah, by = character())
raw[[max(length(raw)) - 1]] %>%
clean_names() %>%
dplyr::select(shots) %>%
mutate(
order = row_number(),
meta = ifelse(
order == 1, "away", ifelse(
order == 2, "home", NA
)
)
)
raw[[max(length(raw)) - 1]] %>%
clean_names() %>%
mutate(
order = row_number(),
meta = ifelse(
order == 1, "away", ifelse(
order == 2, "home", NA
)
)
)
raw[[max(length(raw)) - 1]] %>%
clean_names() %>%
mutate(
order = row_number(),
meta = ifelse(
order == 1, "away", ifelse(
order == 2, "home", NA
)
)
) %>%
dplyr::select(shots, meta)
raw[[max(length(raw)) - 1]] %>%
clean_names() %>%
mutate(
order = row_number(),
meta = ifelse(
order == 1, "away", ifelse(
order == 2, "home", NA
)
)
) %>%
dplyr::select(shots, meta) %>%
pivot_wider(values_from = shots,
names_from = meta)
head(bdc, 1)
bdc <- bdc %>% clean_names()
head(bdc, 1)
tm <- raw[[max(length(raw)) - 1]] %>%
clean_names() %>%
mutate(
order = row_number(),
meta = ifelse(
order == 1, "away_team", ifelse(
order == 2, "home_team", NA
)
)
) %>%
dplyr::select(shots, meta) %>%
pivot_wider(values_from = shots,
names_from = meta)
tm
rg %>%
right_join(tm, by = character())
rg <- rg %>%
right_join(tm, by = character())
head(rg, 1)
head(bdc, 1)
colnames(rg)
rg %>%
dplyr::select(game_id, home_team, away_team, period_id, event_no, description, clock, on_ice_situation,
home_goals, away_goals, leader, team, event,
first_player, first_number, second_player, second_number, third_player, third_number,
shot_type, shot_result,
pentalty, penalty_length, penalty_type, penalty_called,
offensive_player_one, offensive_player_two, offensive_player_three,
offensive_player_four, offensive_player_five)
rg %>%
dplyr::select(game_id, home_team, away_team, period_id, event_no, description, clock, on_ice_situation,
home_goals, away_goals, leader, team, event,
first_player, first_number, second_player, second_number, third_player, third_number,
shot_type, shot_result,
penalty, penalty_length, penalty_type, penalty_called,
offensive_player_one, offensive_player_two, offensive_player_three,
offensive_player_four, offensive_player_five)
rg %>% dplyr::select(starts_with("offensive"))
rg %>% dplyr::select(starts_with("offensive")) %>% filter(! is.na(offensive_player_one))
rg %>%
dplyr::select(game_id, home_team, away_team, period_id, event_no, description, clock, on_ice_situation,
home_goals, away_goals, leader, team, event,
first_player, first_number, second_player, second_number, third_player, third_number,
shot_type, shot_result,
penalty, penalty_length, penalty_type, penalty_called,
offensive_player_one, offensive_player_two, offensive_player_three,
offensive_player_four, offensive_player_five)
r <- rg %>%
dplyr::select(game_id, home_team, away_team, period_id, event_no, description, clock, on_ice_situation,
home_goals, away_goals, leader, team, event,
first_player, first_number, second_player, second_number, third_player, third_number,
shot_type, shot_result,
penalty, penalty_length, penalty_type, penalty_called,
offensive_player_one, offensive_player_two, offensive_player_three,
offensive_player_four, offensive_player_five)
view(r)
source('R/pbp_functions.R')
rg <- load_pbp(game_id = 268078)
tm <- raw[[max(length(raw)) - 1]] %>%
clean_names() %>%
mutate(
order = row_number(),
meta = ifelse(
order == 1, "away_team", ifelse(
order == 2, "home_team", NA
)
)
) %>%
dplyr::select(shots, meta) %>%
pivot_wider(values_from = shots,
names_from = meta)
rg <- rg %>%
right_join(tm, by = character())
view(rg)
rg %>%
dplyr::select(home_team, away_team, team,
first_player, event)
rg %>%
dplyr::select(home_team, away_team, team,
first_player, event, seconds)
rg %>%
dplyr::select(home_team, away_team, team,
first_player, event, sec_from_start)
rg %>%
filter(event == "Goalie") %>%
dplyr::select(home_team, away_team, team,
first_player, event, sec_from_start)
rg %>%
filter(event == "Goalie") %>%
dplyr::select(home_team, away_team, team, description,
first_player, event, sec_from_start)
rg %>%
filter(event == "Goalie") %>%
dplyr::select(home_team, away_team, team, description,
first_player, event, sec_from_start) %>%
mutate(
goalie = ifelse(
str_detect(team, away_team), "away_goalie",
ifelse(
str_detect(team, home_team), "home_goalie", NA
)
)
)
rg %>%
filter(event == "Goalie") %>%
# filter(str_detect(description, "Starting|Returned"))
dplyr::select(home_team, away_team, team, description,
first_player, event, sec_from_start) %>%
mutate(
goalie_change = str_extract(description, "Starting|Returned|Pulled"),
goalie = ifelse(
str_detect(team, away_team), "away_goalie",
ifelse(
str_detect(team, home_team), "home_goalie", NA
)
)
)
rg %>%
filter(event == "Goalie") %>%
# filter(str_detect(description, "Starting|Returned"))
dplyr::select(home_team, away_team, team, description,
first_player, event, sec_from_start) %>%
mutate(
goalie_change = str_extract(description, "Starting|Returned|Pulled"),
goalie = ifelse(
str_detect(team, away_team), "away_goalie",
ifelse(
str_detect(team, home_team), "home_goalie", NA
)
)
) %>%
dplyr::select(first_player, sec_from_start, goalie_change, goalie)
rg %>%
filter(event == "Goalie") %>%
# filter(str_detect(description, "Starting|Returned"))
dplyr::select(home_team, away_team, team, description,
first_player, event, sec_from_start) %>%
mutate(
goalie_change = str_extract(description, "Starting|Returned|Pulled"),
goalie = ifelse(
str_detect(team, away_team), "away_goalie",
ifelse(
str_detect(team, home_team), "home_goalie", NA
)
),
first_player = ifelse(goalie_change == "Pulled", "None")
) %>%
dplyr::select(first_player, sec_from_start, goalie_change, goalie)
rg %>%
filter(event == "Goalie") %>%
# filter(str_detect(description, "Starting|Returned"))
dplyr::select(home_team, away_team, team, description,
first_player, event, sec_from_start) %>%
mutate(
goalie_change = str_extract(description, "Starting|Returned|Pulled"),
goalie = ifelse(
str_detect(team, away_team), "away_goalie",
ifelse(
str_detect(team, home_team), "home_goalie", NA
)
),
first_player = ifelse(goalie_change == "Pulled", "None", first_player)
) %>%
dplyr::select(first_player, sec_from_start, goalie_change, goalie)
rg %>%
filter(event == "Goalie") %>%
# filter(str_detect(description, "Starting|Returned"))
dplyr::select(home_team, away_team, team, description,
first_player, event, sec_from_start) %>%
mutate(
goalie_change = str_extract(description, "Starting|Returned|Pulled"),
goalie = ifelse(
str_detect(team, away_team), "away_goalie",
ifelse(
str_detect(team, home_team), "home_goalie", NA
)
),
first_player = ifelse(goalie_change == "Pulled", "None", first_player)
) %>%
dplyr::select(first_player, sec_from_start, goalie_change, goalie) %>%
pivot_wider(names_from = goalie,
values_from = first_player)
gl <- rg %>%
filter(event == "Goalie") %>%
# filter(str_detect(description, "Starting|Returned"))
dplyr::select(home_team, away_team, team, description,
first_player, event, sec_from_start) %>%
mutate(
goalie_change = str_extract(description, "Starting|Returned|Pulled"),
goalie = ifelse(
str_detect(team, away_team), "away_goalie",
ifelse(
str_detect(team, home_team), "home_goalie", NA
)
),
first_player = ifelse(goalie_change == "Pulled", "None", first_player)
) %>%
dplyr::select(first_player, sec_from_start, goalie_change, goalie) %>%
pivot_wider(names_from = goalie,
values_from = first_player)
head(gl)
rg <- rg %>%
right_join(gl, by = c("sec_from_start"))
view(rg)
rg <- load_pbp(game_id = 268078)
rg <- rg %>%
left_join(tm, by = character())
rg <- rg %>%
left_join(gl, by = c("sec_from_start"))
view(rg)
rg <- rg %>%
fill(home_goalie) %>%
fill(away_goalie)
view(rg)
rg <- rg %>%
fill(home_goalie) %>%
fill(away_goalie) %>%
dplyr::filter(event != "Goalie") %>%
mutate(
home_goalie = ifelse(home_goalie == "None", NA, home_goalie),
away_goalie = ifelse(away_goalie == "None", NA, away_goalie)
)
view(rg)
table(rg$event)
rg <- rg %>%
fill(home_goalie) %>%
fill(away_goalie) %>%
dplyr::filter(event != "Goalie") %>%
mutate(
home_goalie = ifelse(home_goalie == "None", NA, home_goalie),
away_goalie = ifelse(away_goalie == "None", NA, away_goalie),
goalie_involved = ifelse(event %in% c("Goal", "PP Goal", "Shot", "Shot BLK") &
str_detect(team, home_team), away_goalie,
ifelse(event %in% c("Goal", "PP Goal", "Shot", "Shot BLK") &
str_detect(team, home_team), home_goalie, NA
)
)
)
view(rg)
rg <- rg %>%
fill(home_goalie) %>%
fill(away_goalie) %>%
dplyr::filter(event != "Goalie") %>%
mutate(
home_goalie = ifelse(home_goalie == "None", NA, home_goalie),
away_goalie = ifelse(away_goalie == "None", NA, away_goalie),
goalie_involved = ifelse(event %in% c("Goal", "PP Goal", "Shot", "Shot BLK") &
str_detect(team, home_team), away_goalie,
ifelse(event %in% c("Goal", "PP Goal", "Shot", "Shot BLK") &
str_detect(team, away_team), home_goalie, NA
)
)
)
view(rg)
colnames(rg)
r <- rg %>%
dplyr::select(game_id, home_team, away_team, period_id, event_no, description, clock, on_ice_situation,
home_goals, away_goals, leader, team, event,
first_player, first_number, second_player, second_number, third_player, third_number,
shot_type, shot_result, goalie_involved,
penalty, penalty_length, penalty_type, penalty_called,
offensive_player_one, offensive_player_two, offensive_player_three,
offensive_player_four, offensive_player_five,
home_goalie, away_goalie, goalie_change)
view(r)
raw[[1]]
rg$time
rg$clock
source('R/pbp_functions.R')
rg <- load_pbp(game_id = 268078)
rg$clock
source('R/pbp_functions.R')
rg <- load_pbp(game_id = 268078)
rg$clock
source('R/pbp_functions.R')
rg <- load_pbp(game_id = 268078)
rg$clock
tm <- raw[[max(length(raw)) - 1]] %>%
clean_names() %>%
mutate(
order = row_number(),
meta = ifelse(
order == 1, "away_team", ifelse(
order == 2, "home_team", NA
)
)
) %>%
dplyr::select(shots, meta) %>%
pivot_wider(values_from = shots,
names_from = meta)
rg <- rg %>%
left_join(tm, by = character())
gl <- rg %>%
filter(event == "Goalie") %>%
# filter(str_detect(description, "Starting|Returned"))
dplyr::select(home_team, away_team, team, description,
first_player, event, sec_from_start) %>%
mutate(
goalie_change = str_extract(description, "Starting|Returned|Pulled"),
goalie = ifelse(
str_detect(team, away_team), "away_goalie",
ifelse(
str_detect(team, home_team), "home_goalie", NA
)
),
first_player = ifelse(goalie_change == "Pulled", "None", first_player)
) %>%
dplyr::select(first_player, sec_from_start, goalie_change, goalie) %>%
pivot_wider(names_from = goalie,
values_from = first_player)
rg <- rg %>%
left_join(gl, by = c("sec_from_start"))
rg <- rg %>%
fill(home_goalie) %>%
fill(away_goalie) %>%
dplyr::filter(event != "Goalie") %>%
mutate(
home_goalie = ifelse(home_goalie == "None", NA, home_goalie),
away_goalie = ifelse(away_goalie == "None", NA, away_goalie),
goalie_involved = ifelse(event %in% c("Goal", "PP Goal", "Shot", "Shot BLK") &
str_detect(team, home_team), away_goalie,
ifelse(event %in% c("Goal", "PP Goal", "Shot", "Shot BLK") &
str_detect(team, away_team), home_goalie, NA
)
),
time_elapsed = time,
time_remaining = clock
)
view(rg)
r <- rg %>%
dplyr::select(game_id, home_team, away_team, period_id, event_no, description, time_remaining, on_ice_situation,
home_goals, away_goals, leader, team, event,
first_player, first_number, second_player, second_number, third_player, third_number,
shot_type, shot_result, goalie_involved,
penalty, penalty_length, penalty_type, penalty_called,
offensive_player_one, offensive_player_two, offensive_player_three,
offensive_player_four, offensive_player_five,
home_goalie, away_goalie, goalie_change)
view(r)
gl
rg <- load_pbp(game_id = 268078)
rg <- rg %>%
left_join(tm, by = character())
gl <- rg %>%
filter(event == "Goalie") %>%
# filter(str_detect(description, "Starting|Returned"))
dplyr::select(home_team, away_team, team, description,
first_player, event, sec_from_start) %>%
mutate(
goalie_change = str_extract(description, "Starting|Returned|Pulled"),
goalie = ifelse(
str_detect(team, away_team), "away_goalie",
ifelse(
str_detect(team, home_team), "home_goalie", NA
)
),
first_player = ifelse(goalie_change == "Pulled", "None", first_player)
) %>%
dplyr::select(first_player, sec_from_start, goalie_change, goalie) %>%
pivot_wider(names_from = goalie,
values_from = first_player)
g <- rg %>%
left_join(gl, by = c("sec_from_start"))
View(g)
rg <- rg %>%
left_join(gl, by = c("sec_from_start"))
rg <- rg %>%
fill(home_goalie) %>%
fill(away_goalie) %>%
dplyr::filter(event != "Goalie") %>%
mutate(
home_goalie = ifelse(home_goalie == "None", NA, home_goalie),
away_goalie = ifelse(away_goalie == "None", NA, away_goalie),
goalie_involved = ifelse(event %in% c("Goal", "PP Goal", "Shot", "Shot BLK") &
str_detect(team, home_team), away_goalie,
ifelse(event %in% c("Goal", "PP Goal", "Shot", "Shot BLK") &
str_detect(team, away_team), home_goalie, NA
)
),
time_elapsed = time,
time_remaining = clock
)
source('R/pbp_functions.R')
a <- Sys.time()
rg <- load_pbp(game_id = 268078)
Sys.time() - a
source('R/pbp_functions.R')
a <- Sys.time()
rg <- load_pbp(game_id = 268078, type = "clean")
Sys.time() - a
a <- Sys.time()
rg <- load_pbp(game_id = 268078)
Sys.time() - a
source('R/pbp_functions.R')
a <- Sys.time()
rg <- load_pbp(game_id = 268078)
Sys.time() - a
source('R/pbp_functions.R')
a <- Sys.time()
rg <- load_pbp(game_id = 268078)
Sys.time() - a
head(rg, 1)
View(rg)
View(r)
setdiff(colnames(rg), colnames(r))
setdiff(colnames(r), colnames(rg))
rm(list = ls())
source('R/pbp_functions.R')
a <- Sys.time()
rg <- load_pbp(game_id = 268078)
rg_messy <- load_pbp(game_id = 268078, format = "messy")
Sys.time() - a
view(rg)
rm(list = ls())
source('R/pbp_functions.R')
a <- Sys.time()
rg <- load_pbp(game_id = 268078)
rg_messy <- load_pbp(game_id = 268078, format = "messy")
Sys.time() - a
a <- Sys.time()
rg <- load_pbp(game_id = 268078)
rg_messy <- load_pbp(game_id = 268078, format = "messy")
Sys.time() - a
ot <- load_pbp(game_id = 268116)
ot2 <- load_pbp(game_id = 268116, format = "messy")
so <- load_pbp(game_id = 268123)
so2 <- load_pbp(game_id = 268123, format = "m")
Sys.time() - a
write.csv(rg, file = "clean_data.csv", row.names = FALSE)
write.csv(rg_messy, file = "messy_data.csv", row.names = FALSE)
View(so2)
View(so2)
View(so2)
View(so)
